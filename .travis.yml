language: python

# Cache dependencies between builds
cache: pip

python:
  - "3.6"

# Required by deploy.sh
node_js:
  - "8.7"

services:
  - postgresql

install:
  - pip install pipenv
  - pipenv install

before_script:
  - psql -c 'create database personal;' -U postgres
  - pipenv run python manage.py migrate

script:
  - pipenv run python manage.py test

before_deploy:
  - npm install -g captainduckduck

deploy:
  provider: script
  script: captainduckduck deploy -h 167.99.84.65 -a api -p $CAPTAIN_PASSWORD
  on:
    branch: master

env:
  global:
    secure: "geTpCwxeWim3apFYRg/4qBsFAVvcF6OWJdoE4ffA3s8eZ1gbLzhCCzZ9KhjD/I8ji7CrhlONIrg01/FdqFfNM9LOhV6UNRL0uKWp71Nz5yB4s06RRSDxHY+fPnbVPEg62ICMRHnBljXb1GC0PZiNKEdLsOwUNUlT2f5PBhjvqKQs3pDYNpSTbw4Oyjl8qEBYRsz/utKGxot2vIBeNbtuaSj6gBb9TS3yHOxQaM5KltJbcV64PsBl12fKOw9KXKiZQp76bjx+I0v8G47UPvBo+VvnyRJ/8rsWKImsQjtw+Il8FyCzIsC1IVlp12jh+KGZwIANW2vxGaMwIoXtqkXsKmx0rSvWaKKjU3OhhC8rnl8G1vgFghQ1EWFrkslMuuUmsmgRDhZA7B6O/O1ZD6GED9Z9/yOIpGDIplkQYXYW1W2MxcDngCHhvzGzAPberK+YUCJvE+DMdCpH0s+nwAftdrahg2g2bvKPvE7BBCFsymQSd8HpBMOw+FzeruohaK9mMYrrQFIAxWS0uQy0dBvRHwSDvjC2bg6hEyO7eYXfk0eQJE3rWnxQu9t/DsgRytberAsOm8y/EAC4XUkbeaeSWknmiyOFUK/YqUOyx+QjX6lpu4vzqjxh73dZtFp+kbkM1p1A3BH+7o+mf8zTUIUjjp31E7pQwl4kSBaHJDylVPE="
