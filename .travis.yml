language: python

# Cache dependencies between builds
cache: pip

python:
  - "3.6"

# Required by deploy.sh
node_js:
  - "8.7"

services:
  - postgresql

install:
  - pip install pipenv
  - pipenv install

before_script:
  - psql -c 'create database personal;' -U postgres
  - pipenv run python manage.py migrate

script:
  - pipenv run python manage.py test

before_deploy:
  - npm install -g captainduckduck

deploy:
  provider: script
  script: captainduckduck deploy -h 167.99.84.65 -a api -p $CAPTAIN_PASSWORD
  on:
    branch: master

env:
  global:
    secure: "e17gRjPcVNAFxshWElAvU1GSaCeK+rLo5tB2Hjo2Q9TjwzA/0SLfHA2gFhSL0Zhks+GsPjcyvtG3jf45ePrei4wlQbnKb4VEI9v/9SBdfXBPC1ahV4Fx8iAspqVTBnzCIBYLsM6ias10WG4s8MMO1sblyNh0nzMbu5mqm1pNKdqM9fQPdnnDPmR+03f/KrgKpSWUistlnE7hARvOdcVe2IqzTQXupQLJJoyN6BsOvrOnAI6heurSWHQrWMHdy/gpNE6YgB0aUxlKiZj6Q1ZsAV3bb1/puKvgUkib2Zs83W0X4DdQBFTIwXifAtTc+fHORPdew8lCOcco+wQNyv4eq3FhlGdXJFRVFr3GvmEOg0JG7F2MnrBHqrYNXMHJYz3Hu/nOdnUrstvMkY2F7WjWXVuyYtK+rzWp0JqCAzCz5LOa1J4aXk+b9el43lPnlmVt6nv4hZGGs4MF6lCbcmX/dO/tL/6zsHLruvxaGtj7EhmS26inUlnOthCr36tEHnuOIqZ4idGF0dDfhbEf1CzKvMEy1wswobKDJ51YSg6i2r/ZJupCBxczBTL4mJrkc3Q7yjiMGWamzBY2mwGt0MNWnlaRMfLvvNrtw2/ukU3YH4XN+qpllJWvc7XCkQKco5DhM3SBInmh570H0f65XnhJ3Je8oIR1dI6b35eiAHTjAZM="
